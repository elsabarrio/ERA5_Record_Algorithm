---
title: "1-Data_frames_construction"
format: html
editor: visual
---

## Data frames construction

This piece of code created a folder called 'grid_data' inside the 'Data' folder containing one dataframes (one for each grid point) of geopotential variables for the years between 1960-2023 in the summer months: June, July, and August. The columns of the data frames are the variables and the rows the days.

```{r message = FALSE, warning = FALSE}

# Clean workspace
rm(list = ls())

# Set data directory
data_dir <- "../../../Data"
if(!dir.exists(data_dir)) stop("data_dir not found")

# Set functions directory
functions_dir <- "../../../R"

# Out directory
outdir <- file.path(data_dir, "grid_data")
if(!dir.exists(outdir)){
  
  # Create directory to save the dataframes
  dir.create(outdir, recursive = T)
  
  # Load auxiliary function
  source(file.path(functions_dir,"get_grid_data.R"))
  
  # Run it for each geopotential level
  glevels <- c("300","500","700")
  for(aa in 1:length(glevels)){
    
    print(glevels[aa])
    
    # Set input/output file names
    ifile <- paste0("g_",glevels[aa],"_12pm_60_23.rds")
    ofile <- paste0("g",glevels[aa],"_grid.csv")
    
    # Create grid dataframe
    tic <- Sys.time()
    get_grid_data(indir = file.path(data_dir, "geo_data"),
                  infile = ifile, 
                  inlat = "lat.rds",
                  inlon = "lon.rds",
                  indates = "Date.rds",
                  indays = c("06-01", "08-31"),
                  outdir = file.path(data_dir, "grid_data"),
                  outfile = ofile)
    toc <- Sys.time()
    print(toc-tic) # Time difference of 1.859143 mins

  }# for aa level
}# if outdir exist
```
